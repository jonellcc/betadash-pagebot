<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Session</title>
  <meta name="description" content="Auto PageBot is a Messenger automation tool for Facebook pages, making it easy to manage and automate your Messenger experience." />
  <link rel="icon" href="https://github.com/images/modules/copilot-immersive-v1/hero.png" />
  <meta property="og:image" content="https://github.com/images/modules/copilot-immersive-v1/hero.png" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.6/dist/sweetalert2.min.css" />
  <style>
    body { font-family: 'Outfit', sans-serif; }
    .fade-in { animation: fadeIn 1s cubic-bezier(0.4,0,0.2,1) both; }
    @keyframes fadeIn { 0% { opacity: 0; transform: translateY(48px);} 100% { opacity: 1; transform: none;}}
    .sidebar-open { transform: translateX(0);}
    .sidebar-closed { transform: translateX(-100%);}
    .sidebar-transition { transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);}
    .backdrop { background: rgba(30,41,59,0.43);}
    .animate-spin-slow { animation: spin 7s linear infinite;}
    @keyframes spin {100% { transform: rotate(360deg);}}
    ::selection { background: #64748b; color: #f1f5f9;}
    html { scroll-behavior: smooth;}
    ::-webkit-scrollbar { width: 8px; background: #23272e;}
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 6px;}
    .modal-animate-in { animation: modalIn 0.22s cubic-bezier(0.4,0,0.2,1) both; }
    .modal-animate-out { animation: modalOut 0.18s cubic-bezier(0.4,0,0.2,1) both; }
    @keyframes modalIn { 0% { opacity:0; transform: translate(-50%, -60%) scale(0.98);} 100% { opacity:1; transform: translate(-50%, -50%); } }
    @keyframes modalOut { 0% { opacity:1; transform: translate(-50%, -50%);} 100% { opacity:0; transform: translate(-50%, -60%) scale(0.98);} }
    .btn-animated { transition: transform 0.13s cubic-bezier(0.4,0,0.2,1), background 0.13s, box-shadow 0.13s; }
    .btn-animated:active { transform: scale(0.97); }
    .btn-animated:hover { box-shadow: 0 2px 16px 0 #2563eb33; background: #2563eb; }
    .spinner { border: 4px solid #64748b; border-top: 4px solid #60a5fa; border-radius: 50%; width: 28px; height: 28px; animation: spin 1s linear infinite; margin: auto; }
    .swal2-popup { font-family: 'Outfit', sans-serif !important; }
    .tutorial-content a { display: inline-block; word-break: break-word; overflow-wrap: anywhere; vertical-align: baseline; padding-bottom: 2px; }
    .tutorial-content code { background: #222b3a; color: #7dd3fc; padding: 1px 6px; border-radius: 4px; font-size: 90%; font-family: 'Outfit', monospace; }
    .tutorial-content ul { margin-bottom: 1.3em; }
    .tutorial-content li { margin-bottom: 0.4em; }
    @media (min-width: 768px) { #sidebar { width: 16rem; } }
    @keyframes animatedBgGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .animated-gradient-text {
      background: linear-gradient(90deg, #38bdf8, #6366f1, #0ea5e9, #f472b6, #38bdf8);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
      animation: animatedBgGradient 2.6s ease-in-out infinite, slidefade 1s cubic-bezier(0.4,0,0.2,1) both;
      display: inline-block;
    }
    @keyframes slidefade {
      0% { opacity: 0; transform: translateY(20px) scale(0.96); filter: blur(2px); }
      100% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
    }
  </style>
</head>
<body class="bg-slate-950 text-white">

<section id="page-session" class="fade-in flex flex-col items-center justify-center px-2 sm:px-6 py-8 transition-all duration-300">
  <div class="w-full max-w-3xl bg-gradient-to-br from-gray-900 via-slate-900 to-blue-950/80 shadow-2xl rounded-3xl p-4 sm:p-8 flex flex-col min-h-[40vh] border border-blue-900">
    <h2 class="text-2xl font-bold text-blue-200 mb-2 animated-gradient-text">Current Online(s)</h2>
    <p class="text-xs font-semibold text-left text-gray-500 mb-4">Total Online: <span id="totalOnlineCount">0</span></p>
    <div id="sessionLoading" class="text-center text-slate-400 py-4">Loading...</div>
    <div id="sessionList"></div>
  </div>
</section>

<section id="page-privacy" class="hidden fade-in flex flex-col items-center justify-center px-2 sm:px-6 py-8 transition-all duration-300">
  <div class="relative w-full max-w-3xl bg-gradient-to-br from-slate-900 via-gray-900 to-blue-950/90 shadow-2xl rounded-3xl p-4 sm:p-10 border border-blue-900">
    <div class="pointer-events-none absolute inset-0 z-[-1] overflow-hidden">
      <div class="absolute top-10 left-[-50px] w-40 h-40 bg-blue-800 opacity-40 rounded-full blur-2xl animate-pulse"></div>
      <div class="absolute bottom-[10%] right-[-40px] w-28 h-28 bg-cyan-900 opacity-30 rounded-full blur-2xl animate-pulse"></div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.6/dist/sweetalert2.all.min.js"></script>
<script>
function fetchSessionList() {
  document.getElementById('sessionLoading').style.display = '';
  const sessionList = document.getElementById('sessionList');
  const totalOnlineCount = document.getElementById('totalOnlineCount');
  sessionList.innerHTML = '';
  totalOnlineCount.textContent = '0';

  const showError = () => {
    sessionList.innerHTML = `
      <div class="w-full max-w-xl mx-auto mb-3 p-3 rounded-xl bg-slate-800/60 shadow flex items-center justify-center gap-3 border border-red-900/50">
        <i class="fa-solid fa-triangle-exclamation text-red-400 text-lg"></i>
        <span class="text-red-400 font-semibold">Failed to load sessions.</span>
      </div>`;
  };

  fetch('/session')
    .then(res => res.json())
    .then(data => {
      document.getElementById('sessionLoading').style.display = 'none';
      if (!data) return showError();

      const pages = [];

      if (data.main && data.main.PAGEID) {
        pages.push({
          pageID: data.main.PAGEID,
          thumbnailUrl: data.main.profileUrl,
          adminIDs: data.main.ADMINS
        });
      }

      if (Array.isArray(data.session)) {
        data.session.forEach(sess => {
          pages.push({
            pageID: sess.PAGEID,
            thumbnailUrl: sess.ProfileUrl,
            adminIDs: [sess.ADMINID]
          });
        });
      }

      totalOnlineCount.textContent = pages.length;

      if (!pages.length) {
        sessionList.innerHTML = '<div class="text-slate-400 text-center py-3">No online sessions found.</div>';
      } else {
        sessionList.innerHTML = pages.map(page => `
          <div class="w-full max-w-xl mx-auto mb-3 p-3 rounded-xl bg-slate-800/60 shadow flex items-center gap-3 border border-slate-700">
            <img src="${page.thumbnailUrl}" alt="page" class="w-10 h-10 rounded-full shadow border border-slate-700 bg-gray-800 object-cover flex-shrink-0">
            <div class="flex-1 min-w-0">
              <div class="text-sm text-blue-200 font-semibold leading-tight mb-1">Page ID: ${page.pageID}</div>
              <div class="flex flex-wrap items-center gap-2 mb-1">
                <span class="text-xs text-slate-400">URL:</span>
                <a href="https://m.me/${page.pageID}" target="_blank" class="text-xs px-2 py-0.5 rounded bg-blue-800 text-blue-100 font-semibold hover:bg-blue-700 transition-colors break-all">m.me/${page.pageID}</a>
              </div>
              ${page.adminIDs && page.adminIDs.length ? `<div class="text-xs text-slate-300 truncate">Admin IDs: ${page.adminIDs.join(', ')}</div>` : ''}
            </div>
          </div>
        `).join('');
      }
    })
    .catch(() => {
      document.getElementById('sessionLoading').style.display = 'none';
      showError();
    });
}

document.addEventListener('DOMContentLoaded', fetchSessionList);
</script>
</body>
</html>
